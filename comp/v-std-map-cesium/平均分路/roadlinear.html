<!DOCTYPE html>
<head>
    <script src="../../../lib/CesiumUnminified/Cesium.js"></script>
   
</head>
<style>
    #cesiumContainer {
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: default;
    }
    .cesium-viewer {
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: default;
    }
    .cesium-viewer-cesiumWidgetContainer {
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: default;
    }
    .cesium-widget {
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: default;
    }
    .cesium-widget canvas {
        width: 100%;
        height: 100%;
        overflow: hidden;
        cursor: default;
    }
    #cesiumContainer .cesium-viewer, 
    #cesiumContainer .cesium-viewer-cesiumWidgetContainer, 
    #cesiumContainer .cesium-widget, canvas {
        width: 100%;
        height: 100%;
    }
</style>
<body>
<div id="cesiumContainer"></div>
<script>
    var xinbo_wgs84_data = [114.222179,24.036288,114.221749,24.035974,114.220804,24.035611];
    var xinbo_wgs84_data1 = [114.222179,24.036288,114.221749,24.035974,114.220804,24.035611,114.218011,24.034756,114.217071,24.034383,114.21656,24.034123,114.21627,24.033922,114.215717,24.033446,114.215443,24.033151,114.214798,24.032269,114.214771,24.031965,114.214664,24.03118,114.21461,24.030759,114.214632,24.02997,114.215137,24.028274,114.215658,24.026936,114.216018,24.025755,114.216351,24.02426,114.216582,24.023128,114.216599,24.021864,114.216185,24.019711,114.21567,24.018186,114.212903,24.013664,114.212124,24.012664,114.210588,24.010196,114.210179,24.009034,114.209674,24.005582,114.209728,24.002704,114.209734,23.999493,114.209723,23.998934,114.209191,23.995159,114.209148,23.994899,114.208681,23.993246,114.20852,23.992677,114.208359,23.992118,114.207795,23.989847,114.207553,23.988758,114.206951,23.985826,114.206156,23.98203,114.205925,23.980995,114.205651,23.979553,114.205297,23.977527,114.204743,23.974349,114.204485,23.972574,114.204034,23.969562,114.203594,23.966433,114.203406,23.965231,114.203073,23.961975,114.20289,23.960194,114.202681,23.954358,114.202595,23.951709,114.202552,23.950949,114.202552,23.949301,114.203031,23.946373,114.203133,23.945648,114.203907,23.943525,114.20502,23.940818,114.205632,23.939784,114.206933,23.937838,114.208551,23.93551,114.210356,23.932505,114.210464,23.932309,114.211028,23.931073,114.211195,23.93047,114.212049,23.927817,114.212119,23.926169,114.212022,23.923932,114.211276,23.92009,114.209245,23.91554,114.208031,23.912556,114.207445,23.910451,114.207295,23.908763,114.207214,23.907929,114.207279,23.904878,114.207946,23.900311,114.208467,23.896376,114.207839,23.892588,114.207436,23.890144,114.206329,23.885388,114.206168,23.884755,114.205319,23.881893,114.204728,23.879876,114.2044,23.877692,114.204486,23.87542,114.20482,23.874188,114.205626,23.872,114.20669,23.869818,114.208308,23.867847,114.212564,23.863551,114.214745,23.86134,114.217367,23.859192,114.220037,23.857839,114.223576,23.85632,114.225526,23.855378,114.229682,23.8535,114.231185,23.852803,114.231593,23.852592,114.23272,23.851944,114.234621,23.850614,114.236763,23.848852,114.238883,23.846599,114.239983,23.845156,114.241701,23.843104,114.242473,23.842176,114.243627,23.840816,114.243874,23.840521,114.244904,23.839348,114.245296,23.838877,114.247056,23.836853,114.247957,23.835808,114.250768,23.832561,114.252485,23.829134,114.252936,23.827666,114.253526,23.825285,114.254454,23.821573,114.255227,23.81844,114.255849,23.815936,114.256621,23.812828,114.257169,23.810814,114.257887,23.80913,114.258654,23.80776,114.259523,23.806536,114.261046,23.804831,114.262274,23.803814,114.265931,23.800741,114.268831,23.798298,114.272953,23.794826,114.274298,23.793656,114.275633,23.79224,114.275853,23.791959,114.277305,23.789866,114.277981,23.788441,114.278693,23.786161,114.279374,23.784019,114.28028,23.780409,114.281089,23.777402,114.281802,23.77471,114.282745,23.772209,114.28378,23.770572,114.284653,23.769215,114.285162,23.768488,114.286105,23.767165,114.286234,23.766968,114.287531,23.763887,114.288431,23.761568,114.289133,23.759582,114.289771,23.756006,114.290081,23.753574,114.290312,23.751948,114.290864,23.749712,114.291223,23.748282,114.291443,23.747653,114.291748,23.746744,114.292257,23.745211,114.292718,23.744154,114.293104,23.743205,114.293661,23.741367,114.294186,23.739058,114.294202,23.735683,114.294197,23.734564,114.293661,23.73205,114.292553,23.728589,114.292247,23.727656,114.291792,23.726414,114.291583,23.725044,114.291535,23.723162,114.291364,23.720844,114.291707,23.717611,114.29198,23.715306,114.292264,23.712914,114.292382,23.711739,114.292838,23.70743,114.292924,23.706653,114.292892,23.704959,114.292715,23.703313,114.292324,23.700297,114.292121,23.699222,114.292057,23.696849,114.292598,23.694479,114.293648,23.691765,114.294639,23.690452,114.296123,23.68838,114.296686,23.687613,114.297516,23.686629,114.298298,23.685286,114.299568,23.682252,114.299986,23.680629,114.300227,23.679052,114.300468,23.676727,114.300698,23.67454,114.301015,23.673154,114.301781,23.671388,114.301872,23.671132,114.302756,23.669823,114.304737,23.667775,114.307346,23.665072,114.308674,23.663684,114.310062,23.66203,114.310774,23.660938,114.311101,23.660106,114.311545,23.658533,114.311926,23.65724,114.312113,23.655691,114.312151,23.654561,114.311942,23.653023,114.311187,23.650233,114.310689,23.649064,114.3092,23.646413,114.309029,23.646173,114.307005,23.643164,114.30392,23.639032,114.303277,23.638178,114.302945,23.637736,114.301387,23.635807,114.300567,23.635057,114.299116,23.633723,114.297198,23.632163,114.294938,23.630958,114.293984,23.630429,114.291606,23.628988,114.290593,23.628395,114.287631,23.626193,114.28575,23.62428,114.28432,23.62235,114.28364,23.621186,114.282257,23.617644,114.281786,23.615939,114.281556,23.614843,114.281368,23.612228,114.281251,23.60833,114.28116,23.605317,114.281122,23.601856,114.28108,23.597431,114.281037,23.594059,114.281016,23.590765,114.28107,23.589206,114.281257,23.587436,114.281842,23.583482,114.282265,23.580639,114.282823,23.576852,114.282903,23.576292,114.283037,23.575746,114.283155,23.575249,114.283653,23.573611,114.284104,23.572327,114.28442,23.571549,114.284934,23.570511,114.285341,23.569797,114.285952,23.568764,114.286424,23.567991,114.287849,23.565972,114.289821,23.563353,114.291069,23.561634,114.291583,23.560788,114.292291,23.55909,114.292602,23.55758,114.293255,23.554259,114.293813,23.551421,114.294429,23.548051,114.29482,23.545719,114.295324,23.542851,114.295779,23.540165,114.296004,23.538881,114.296246,23.537488,114.296465,23.536367,114.296883,23.534718,114.297076,23.534044,114.297526,23.532942,114.298094,23.531952,114.298464,23.531366,114.299969,23.529312,114.301779,23.526795,114.302026,23.526421,114.303237,23.524289,114.30382,23.523034,114.304201,23.522059,114.304345,23.521601,114.304619,23.520474,114.304801,23.519259,114.304962,23.517763,114.30516,23.516041,114.305278,23.513887,114.305321,23.5128,114.305316,23.511673,114.305289,23.508594,114.305268,23.505229,114.305257,23.504968,114.305321,23.503773,114.305525,23.502189,114.305782,23.500511,114.30597,23.499261,114.305991,23.498739,114.306072,23.497342,114.306088,23.495935,114.305986,23.494563,114.305927,23.493589,114.305788,23.492393,114.305676,23.491508,114.305194,23.489831,114.304749,23.48877,114.304075,23.487379,114.303534,23.486386,114.302907,23.485344,114.301948,23.483909,114.300561,23.481816,114.29754,23.477325,114.296437,23.47559,114.296035,23.474671,114.29581,23.473855,114.295553,23.472674,114.295339,23.469968,114.295329,23.469442,114.295345,23.468359,114.295463,23.466908,114.295554,23.465431,114.295586,23.463483,114.295308,23.460713,114.295147,23.459926,114.294756,23.458977,114.294204,23.45796,114.29324,23.456539,114.293058,23.456264,114.292142,23.45507,114.291039,23.45361,114.288821,23.450696,114.287251,23.448617,114.28513,23.445855,114.283437,23.443599,114.282612,23.442528,114.281342,23.440847,114.280088,23.439205,114.279483,23.438384,114.279011,23.437538,114.278309,23.435837,114.277307,23.432811,114.276171,23.429383,114.275566,23.427577,114.275384,23.426524,114.275266,23.425437,114.27525,23.424467,114.275363,23.423375,114.275883,23.42107,114.276054,23.420406,114.276692,23.417388,114.276842,23.416246,114.276874,23.41563,114.276837,23.414789,114.276644,23.412855,114.276617,23.412594,114.276173,23.409937,114.275841,23.407953,114.275675,23.40692,114.27546,23.405025,114.275289,23.403189,114.275364,23.401014,114.275568,23.399497,114.275755,23.398685,114.276115,23.3977,114.276736,23.396424,114.277219,23.395655,114.278269,23.394315,114.280509,23.391663,114.283494,23.388089,114.284732,23.386605,114.285107,23.386127,114.285879,23.385058,114.286591,23.383594,114.287015,23.382387,114.287218,23.381693,114.287604,23.379664,114.287781,23.377975,114.287883,23.375479,114.287996,23.372342,114.28813,23.36862,114.28828,23.364194,114.288382,23.361545,114.288495,23.35828,114.288618,23.354331,114.288683,23.352258,114.288715,23.348673,114.288796,23.344182,114.288807,23.343606,114.288689,23.340405,114.288678,23.339873,114.288346,23.336919,114.28802,23.334177,114.287752,23.331942,114.287382,23.32949,114.286852,23.326275,114.28652,23.325143,114.286236,23.324459,114.286129,23.324188,114.285615,23.322943,114.285133,23.322062,114.283477,23.320183,114.281977,23.318408,114.281425,23.317729,114.280337,23.3158,114.279807,23.31455,114.279384,23.313048,114.279132,23.311798,114.278789,23.308971,114.278414,23.307174,114.277878,23.305515,114.277134,23.303792,114.276271,23.302345,114.273741,23.298738,114.270955,23.294826,114.26858,23.291533,114.267031,23.289427,114.264683,23.286371,114.263777,23.285436,114.262683,23.284259,114.261439,23.283167,114.259847,23.282178,114.255611,23.279596,114.253921,23.278562,114.251009,23.276505,114.249802,23.275515,114.248868,23.274683,114.248525,23.274354,114.247366,23.273167,114.246959,23.272753,114.246014,23.271773,114.245296,23.270966,114.243927,23.269503,114.242935,23.268533,114.24118,23.266779,114.239726,23.265498,114.238873,23.264745,114.237043,23.263272,114.235711,23.262163,114.234139,23.260754,114.233323,23.259779,114.232749,23.258838,114.231492,23.256172,114.230306,23.253427,114.22942,23.251067,114.228819,23.249638,114.227987,23.248337,114.227187,23.247154,114.226231,23.245779,114.224991,23.244492,114.224164,23.243635,114.223262,23.242757,114.22143,23.24151,114.218981,23.239833,114.217703,23.238773,114.215404,23.236898,114.214249,23.235493,114.21123,23.230622,114.210687,23.229527,114.209548,23.227181,114.208388,23.224789,114.207625,23.222995,114.20742,23.222531,114.207044,23.221506,114.206932,23.220959,114.206862,23.220431,114.206797,23.219382,114.20676,23.218519,114.206754,23.216587,114.206738,23.215444,114.206653,23.214384,114.206481,23.212314,114.206207,23.209361,114.205976,23.20734,114.205562,23.203417,114.205213,23.200636,114.20495,23.199024,114.204552,23.196924,114.204053,23.194257,114.203789,23.192798,114.20308,23.190056,114.202919,23.189405,114.201919,23.186235,114.201285,23.184607,114.200581,23.182881,114.200275,23.182107,114.199641,23.180469,114.199367,23.179695,114.199254,23.179394,114.198448,23.177283,114.198168,23.176519,114.196722,23.173396,114.194836,23.169208,114.193986,23.167334,114.193433,23.166169,114.192594,23.1646,114.192266,23.163979,114.191691,23.163061,114.190352,23.160791,114.189713,23.159607,114.189444,23.159,114.189041,23.157924,114.188342,23.15606,114.187863,23.154659];
    var wmtstdt_yx = new Cesium.WebMapTileServiceImageryProvider({
        url: 'http://t0.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=c278d0197c8862311c5aa1730d08b9dd',
        //wmtstdt_yx
        layer: 'img',
        style: 'default',
        format: 'tiles',
        tileMatrixSetID: 'w',
        //credit: new Cesium.Credit('ÌìµØÍ¼È«ÇòÊ¸Á¿·þÎñ'),
        //subdomains: ['t0', 't1', 't2', 't3', 't4', 't5', 't6', 't7'],
        //maximumLevel: 15,
        //tilingScheme: new Cesium.GeographicTilingScheme(),
        //tileMatrixLabels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19']
        minimumLevel: 0,
        maximumLevel: 15
    });
    var viewer = new Cesium.Viewer('cesiumContainer', {
        imageryProvider: wmtstdt_yx,
        homeButton: false,
        infoBox: false,
        timeline: false,
        navigationHelpButton: false,
        navigationInstructionsInitiallyVisible: false,
        shouldAnimate: true,
        sceneModePicker: false,
        selectionIndicator:false,
        showGroundAtmosphere:false
        //terrainProvider:terrainProvider
    });

    var flyTo = function (lon, lat, height, animationtime) {
        viewer.camera.flyTo({
            duration: animationtime,
            destination: new Cesium.Cartesian3.fromDegrees(lon, lat, height),
        });
    };

    var scene = viewer.scene;

    var ellipsoid = scene.globe.ellipsoid;

    //方式：添加rgb3个道路，采用3中材质，顺序叠加
    //type: 0:red 1:green 2:yellow
    // var mat_glsl = 
    //     'vec2 resolution = vec2(1.0,1.0); \n\
    //     czm_material czm_getMaterial(czm_materialInput materialInput) \n\
    //     {\n\
    //         czm_material m = czm_getDefaultMaterial(materialInput);\n\
    //         vec2 p = materialInput.st.xy;//(materialInput.st.xy * 2.0 - resolution) / min(resolution.x, resolution.y);\n\
    //         if(type==1.0){\n\
    //             //绿色为底,布满全路线\n\
    //             m.diffuse = vec3(0.0,1.0,0.0);\n\
    //             m.alpha = 0.10;\n\
    //         }\n\
    //         else if(type==0.0){\n\
    //             vec3  col = vec3(1.0,0.0,0.0);\n\
    //             m.diffuse  = col;\n\
    //             float offsetAlpha = (p.x-0.5)/(0.6-0.5)*2.0 - 1.0;\n\
    //             m.alpha = 1.0-smoothstep(0.0,1.0,abs(offsetAlpha));\n\
    //         } else if(type==2.0){\n\
    //             vec3  col = vec3(1.0,1.0,0.0);\n\
    //             m.diffuse  = col;\n\
    //             float offsetAlpha = (p.x-0.2)/(0.6-0.2)*2.0 - 1.0;\n\
    //             m.alpha = 1.0-smoothstep(0.0,1.0,abs(offsetAlpha));\n\
    //         }\n\
    //         return m;\n\
    //     }'

        var mat_glsl = 
        'vec2 resolution = vec2(1.0,1.0); \n\
        //获取每段路的颜色\n\
        vec3 getColorById(int i){\n\
            vec3  colr = vec3(1.0,0.0,0.0);\n\
            vec3  colg = vec3(0.0,1.0,0.0);\n\
            vec3  colb = vec3(0.0,0.0,1.0);\n\
            vec3 color = vec3(0.0,0.0,0.0);\n\
            float id = mod(float(i),2.0);\n\
            if(id==0.0){\n\
                color  = colr;\n\
            }else if(id==1.0){\n\
                color = vec3(1.0,1.0,0.0);;\n\
            }else if(id==2.0){\n\
                color  = colb;\n\
            }else if(id==3.0){\n\
                color  = vec3(0.5,0.5,0.5);\n\
            }\n\
            return color;\n\
        }\n\
        czm_material czm_getMaterial(czm_materialInput materialInput) \n\
        {\n\
            czm_material m = czm_getDefaultMaterial(materialInput);\n\
            vec2 p = materialInput.st.xy;//(materialInput.st.xy * 2.0 - resolution) / min(resolution.x, resolution.y);\n\
            if(type==1.0){\n\
                //绿色为底,布满全路线\n\
                m.diffuse = vec3(0.0,1.0,0.0);\n\
                m.alpha = 0.10;\n\
            }\n\
            else if(type==0.0){\n\
                vec3  col = vec3(1.0,0.0,0.0);\n\
                m.diffuse  = col;\n\
                float offsetAlpha = (p.x-0.5)/(0.6-0.5)*2.0 - 1.0;\n\
                m.alpha = 1.0-smoothstep(0.0,1.0,abs(offsetAlpha));//上面不考虑每段线\n\
                //m.alpha = 0.0;\n\
                \n\
                //判断p.x属于哪一段道路\n\
                // for(int i=0;i<497;i++){\n\
                //     if(lineColor[i]!=type)\n\
                //         continue;\n\
                //     float lineSegS = float(lineVertexs[i])*1.0;\n\
                //     float lineSegE = float(lineVertexs[i+1])*1.0;\n\
                //     if(p.x>lineSegS && p.x<lineSegE){\n\
                //         float offsetAlpha = (p.x-lineSegS)/(lineSegE-lineSegS)*2.0-1.0;//把p.x映射到-1，1区间,-1是线段的起点，1是线段的终点\n\
                //         m.alpha = 1.0-smoothstep(0.0,1.0,abs(offsetAlpha));\n\
                //         return m;\n\
                //     }\n\
                // }\n\
            } else if(type==2.0){\n\
                vec3  col = vec3(1.0,1.0,0.0);\n\
                m.diffuse  = col;\n\
                float offsetAlpha = (p.x-0.2)/(0.6-0.2)*2.0 - 1.0;\n\
                m.alpha = 1.0-smoothstep(0.0,1.0,abs(offsetAlpha));\n\
            }\n\
            return m;\n\
        }'

    //道路的长度，总长&每段长度
    var getLength = function(xinbo_wgs84_data){
        var len = 0;
        var lenSeg = [];
        lenSeg.push(0.0);
        for(var i=0;i<=xinbo_wgs84_data.length-4;i+=2){
            var lon0 = xinbo_wgs84_data[i];
            var lat0 = xinbo_wgs84_data[i+1];
            var lon1 = xinbo_wgs84_data[i+2];
            var lat1 = xinbo_wgs84_data[i+3];
            var tlenSeg = Math.pow(Math.pow(lon1-lon0,2) + Math.pow(lat1-lat0,2),0.5);
            len += tlenSeg;
            lenSeg.push(len);
        }
        lenSeg.push(1.0);
        return {length:len,lengthSeg:lenSeg};
    }
    var roadLenght = getLength(xinbo_wgs84_data1);

    //道路的每个顶点在整段路上的占比[0.0,0.11,,,1.0]
    var arrayRoad = new Array(xinbo_wgs84_data1.length/2 - 1);
    for(var i=0;i<arrayRoad.length;i++){
        arrayRoad[i] = roadLenght.lengthSeg[i]/roadLenght.length;
    }
    //道路每段路的颜色
    var arrayColor = new Array(xinbo_wgs84_data1.length/2);
    for(var i=0;i<arrayColor.length-1;i++){
        if(i>arrayColor.length/2.0){
            arrayColor[i] = 0;
        }else{
            arrayColor[i] = 1;
        }  
    }
 
    var redMat = new Cesium.Material({
        fabric : {
            type : 'r',
            uniforms : {
                color : new Cesium.Color(1.0, 0.0, 0.0, 1.0),
                time : 0.0,
                lineVertexs:arrayRoad,
                lineColor:arrayColor,
                type:0
            },
                source : mat_glsl
            }
            
    });
    var greenMat = new Cesium.Material({
        fabric : {
            type : 'g',
            uniforms : {
                color : new Cesium.Color(0.0, 1.0, 0.0, 1.0),
                time : 0.0,
                lineVertexs:arrayRoad,
                lineColor:arrayColor,
                type:1
            },
                source : mat_glsl
            }
            
    });
    var yellowMat = new Cesium.Material({
        fabric : {
            type : 'y',
            uniforms : {
                color : new Cesium.Color(1.0, 1.0, 0.0, 1.0),
                time : 0.0,
                lineVertexs:arrayRoad,
                lineColor:arrayColor,
                type:2
            },
                source : mat_glsl
            }
            
    });

    var tmaterial = new Cesium.ImageMaterialProperty({
               image :  './images/2.jpg',
               repeat : new Cesium.Cartesian2(1500, 1)
        });
    //g
    var greenprimitive = new Cesium.Primitive({
        geometryInstances : new Cesium.GeometryInstance({
            geometry : new Cesium.PolylineGeometry({
                positions : Cesium.Cartesian3.fromDegreesArray(xinbo_wgs84_data1),
                width : 30.0,
                vertexFormat : Cesium.VertexFormat.ALL
            })
        }),
        appearance : new Cesium.PolylineMaterialAppearance({
            material : greenMat
        }),
        index:3,
        clampToGround : true,
    });
    scene.primitives.add(greenprimitive);

    //r
    var redprimitive = new Cesium.Primitive({
        geometryInstances : new Cesium.GeometryInstance({
            geometry : new Cesium.PolylineGeometry({
                positions : Cesium.Cartesian3.fromDegreesArray(xinbo_wgs84_data1),
                width : 30.0,
                vertexFormat : Cesium.VertexFormat.ALL
            })
        }),
        appearance : new Cesium.PolylineMaterialAppearance({
            material : redMat 
        }),
        index:2,
        clampToGround : true,
    });
    scene.primitives.add(redprimitive);

    //y
    var yellowprimitive = new Cesium.Primitive({
        geometryInstances : new Cesium.GeometryInstance({
            geometry : new Cesium.PolylineGeometry({
                positions : Cesium.Cartesian3.fromDegreesArray(xinbo_wgs84_data1),
                width : 30.0,
                vertexFormat : Cesium.VertexFormat.ALL
            })
        }),
        appearance : new Cesium.PolylineMaterialAppearance({
            material : yellowMat 
        }),
        index:2,
        clampToGround : true,
    });
    scene.primitives.add(yellowprimitive);

    // 加载3DTiles数据，纽约进行封装了
    var city = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:Cesium.IonResource.fromAssetId(3839)}))
            
         
            // 设置建筑物的样式
            var heightStyle = new Cesium.Cesium3DTileStyle({
                color:{
                    conditions:[
                      ["${height} >= 300","rgba(45,0,75,0.5)"],
                      ["${height} >= 200","rgb(102,71,151)"],
                      ["${height} >= 100","rgb(170,162,204)"],
                      ["${height} >= 50","rgb(224,226,238)"],
                      ["${height} >= 25","rgb(252,230,200)"],
                      ["${height} >= 10","rgb(248,176,87)"],
                      ["${height} >= 5","rgb(198,106,11)"],
                      ["true","rgb(102,71,151)"]
                    ]
                }
            });

            // 将默认样式改为自定义样式
            city.style = heightStyle;

    //flyTo(114.2,24.03,5000,2);
    viewer.zoomTo(city)
    
</script>
</body>